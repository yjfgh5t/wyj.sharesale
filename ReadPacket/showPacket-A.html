<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>显示红包</title>

    <style type="text/css">
        span {
            margin:0px;
            padding:0px;
        }
        .redpack {
            height: 14.25rem;
            background: #cd533d;
            width: 10rem;
            border-radius: 10px;
            text-align: center;
            position: absolute;
            top: 2rem;
            left: 50%;
            margin-left: -5rem;
            z-index: 5;
        }

        .topcontent {
            height: 7.8rem;
            border: 0.02rem solid #ca4f39;
            background-color: #d85940;
            border-radius: 10px 10px 50% 50% / 10px 10px 15% 15%;
            box-shadow: 0px 2px 0px -1px rgba(0,0,0,0.2);
        }

        #redpack-open {
            line-height: 2.5rem;
            width: 2.5rem;
            height: 2.5rem;
            border: 0.02rem solid #ebcd9a;
            background-color: #ebcd9a;
            border-radius: 50%;
            color: #fff;
            font-size: 1.2rem;
            display: inline-block;
            color: #000;
            margin-top: -1.3333rem;
            box-shadow: 0px 3px 0px 0px rgba(0, 0, 0, 0.2);
        }

        .img-icon {
            width: 1.4rem;
            border-radius: 0.25rem;
            margin-top: 1rem;
            border: 0.01rem solid #d85940;
        }

        .p-title {
            font-size: 0.5333rem;
            color: #ebcd9a;
            margin-top: 0.6rem;
        }

        .p-msg {
            font-size: 0.85rem;
            color: #ebcd9a;
            letter-spacing: 0.15rem;
        }

        html {
            margin: 0;
            padding: 0;
            position: relative;
            background-position: center;
            width: 100%;
            height: 100%;
            overflow-y: hidden;
            background: url(/imgs/bj-a.jpg) no-repeat top left;
            background-size: 100% 100%;
            position: absolute;
        }

        .div-alt-msg {
            font-size: 0.433rem;
            width: 70%;
            margin-left: 15%;
            margin-top: 0.8rem;
            background: white;
            padding: 0.2rem;
            line-height: 0.7rem;
            border-radius: 0.2rem;
            color: #797171;
            visibility: hidden;
        }

        .p-about {
            font-size: 0.4333rem;
            color: rgb(230, 226, 226);
            margin-top: 1.4rem;
            text-decoration: underline;
            letter-spacing: 0.07rem;
        }

        /***遮罩层*/
        .shade {
            position: absolute;
            width: 100%;
            height: 100%;
            background-color: rgba(10, 10, 10, 0.6);
            display: none;
        }

        /**消息*/
        .div-showmsg {
            display: none;
            width: 100%;
            position: absolute;
            top: 20%;
            font-size: 0.46666rem;
        }

            .div-showmsg .div-msg {
                width: 52%;
                margin-left: 20%;
                margin-top: 0.8rem;
                background: white;
                padding: 0.2rem 4%;
                line-height: 0.7rem;
                border-radius: 0.2rem;
                color: #797171;
                text-align: center;
            }

        .div-btn {
            text-align: center;
            margin-top: 0.5rem;
        }

            .div-btn span {
                color: white;
                padding: 0.1rem 0.4rem;
                border: 1px solid;
                margin-top: 0.5rem;
                border-radius: 0.5rem;
                background-color: #00c7ff;
            }
    </style>

    <script src="http://static.qingxixi.com/common/scripts/clipboard.min.js"></script>

</head>
<body style="margin:0px;">

    <div class="shade" id="_div_shade"></div>

    <div class="redpack" id="_div_packet">
        <!--  红包的顶部盖子 -->
        <div class="topcontent">
            <img src="/imgs/icon-alipay.png" class="img-icon" />
            <p class="p-title">支付宝 给你发了一个红包</p>
            <p class="p-msg">恭喜发财 大吉大利</p>
        </div>
        <!-- 拆红包的按钮 -->
        <div id="redpack-open" data-clipboard-text="abcedfg">
            開
        </div>
        <div class="div-alt-msg">
            支付宝红包只有三天的有效期，请您尽快使用哦！
        </div>
        <p class="p-about" id="_p_about">关于我们</p>
    </div>

    <div class="div-showmsg" id="_div_showmsg">
        <div class="div-msg" id="_div_msg">支付宝红包只有三天的有效期，请尽您快使用哦！</div>
        <div class="div-btn"> <span id="_span_btn">我知道</span></div>
    </div>

    <script type="text/javascript">

        //窗体改变事件
        var recalc = function () {
            var clientWidth = document.body.clientWidth;
            if (clientWidth > 1024)
                clientWidth = 414;

            if (!clientWidth) return;
            document.documentElement.style.fontSize = 60 * (clientWidth / 750) + 'px';
        };
        recalc();
        document.addEventListener('DOMContentLoaded', recalc, false);
        window.addEventListener('resize', recalc, false);

        var vPage = {
            dom: {
                divShade: document.getElementById("_div_shade"),
                divShowMsg: document.getElementById("_div_showmsg"),
                divMsg: document.getElementById("_div_msg"),
                spanBtn: document.getElementById("_span_btn"),
                pAbout: document.getElementById("_p_about"),
                readPackOpen: document.getElementById("redpack-open")
            },
            //是否领取红包
            hasGet: false,
            clipBoard: null,
            //初始加载
            init: function () {
                //红包点击事件
                vPage.dom.readPackOpen.addEventListener("click", vPage.packetClick);
                //按鈕点击
                vPage.dom.spanBtn.addEventListener("click", vPage.iknow);
                //关于我们点击
                vPage.dom.pAbout.addEventListener("click", vPage.about);

                //复制
                vPage.copyData();
            },
            //红包点击事件
            packetClick: function () {

                //vPage.showMsg("好的", JSON.stringify(vPage.getOSData()));
                //return;
                if (vPage.hasGet) {
                    vPage.showMsg("好的", "每天只能领取一次红包哦！若未领取，请您打开支付宝App领取");
                    return;
                }

                //打开支付宝app
                vPage.openAlipay(function (open) { 
                    if (open) {
                        vPage.showMsg("我知道", "支付宝红包只有三天的有效期，请您尽快使用哦！");
                    } else {
                        vPage.showMsg("我已领取", "红包已发送至您的支付宝，快去打开支付宝App领取吧！");
                    } 
                });
                 
                vPage.hasGet = true;
            },
            //确定点击
            iknow: function () {
                var _self = vPage.dom.spanBtn;
                if (_self.innerText == '我知道' || _self.innerText == "我已领取") {
                    vPage.dom.divMsg.innerText = "点击右上角按钮分享给微信和QQ好友一起领红包吧！";
                    _self.innerText = "好的";
                } else if (_self.innerText == '赚赏金') {
                    window.location.href = 'addReadPacket.html';
                } else {
                    vPage.dom.divShowMsg.style.display = "none";
                    vPage.dom.divShade.style.display = "none";
                }
            },
            //关于我们
            about: function () {
                vPage.showMsg("赚赏金", "此红包是由支付宝提供的分享红包口令给好友即可瓜分10亿赏金活动！为此掌上微营秀提供一个更加灵活、便利的程序分为您分发支付宝口令，赚取更多的赏金！")
            },
            //显示文案
            showMsg: function (btnMsg, msg) {
                //遮罩层
                vPage.dom.divShade.style.display = "block";
                vPage.dom.divShade.style.zIndex = 7;

                //提示消息
                vPage.dom.divShowMsg.style.display = "block";
                vPage.dom.divShowMsg.style.zIndex = 8;
                vPage.dom.divMsg.innerText = msg;
                vPage.dom.spanBtn.innerText = btnMsg;
            },
            //copy口令
            copyData: function () {
                //  设置copy
                var clipboard = new Clipboard('#redpack-open');

                clipboard.on('success', function (e) {
                    //设置口令
                    //vPage.dom.readPackOpen.setAttribute("data-clipboard-text", "123456");
                });
            },
            //打开支付宝
            openAlipay: function (callback) {

                var OSData = vPage.getOSData();

                //如果在微信中
                if (OSData.Browser == "WeChat") {
                    if (OSData.OSType == "Android")
                        return callback(false); 

                    //小于9的版本
                    if (OSData.OSType == "IOS" && OSData.BVersion < 9)
                        return callback(false); 
                }

                //Android打开app
                if (OSData.OSType == "Android") {
                    //当前时间
                    var dateTimeNow = Date.now();
                    //唤醒App
                    location.href = "alipays:// ";

                    setTimeout(function () {
                        var _dataNow = Date.now() - dateTimeNow;
                        //vPage.showMsg("好的", _dataNow);
                        //打开失败
                        if (_dataNow > 1050){
                            return callback(true);
                        } else {
                            return callback(false);
                       }
                       return;
                    }, 1000);
                    return;
                }else if (OSData.OSType == "IOS") //IOS打开App
                {
                    //如果版本大于9 使用universal link打开
                    if (OSData.BVersion >= 9)
                    {
                        return callback(true);
                    }
                }

                callback(false);
            },
            //获取浏览器类型
            getOSData: function () {

                var ua = navigator.userAgent.toLowerCase();

                var OSType = { OSType: 'Default', Browser: 'Default', BVersion: 0 };

                if (ua.match(/MicroMessenger/i) == "micromessenger") {
                    OSType.Browser = "WeChat";
                } else if (ua.match(/QQ/i) == "qq") {
                    OSType.Browser = "QQ";
                }

                if (!!ua.match(/\(i[^;]+;( u;)? cpu.+mac os x/)) {
                  
                    OSType.OSType = "IOS";
                     
                    //Ios版本 
                    var ver = ua.match(/cpu iphone os (.*?) like mac os/);
                    OSType.BVersion = parseInt(ver[1].replace(/_/g, "").substring(0,1));
                } else if (ua.indexOf('android') > -1 || ua.indexOf('adr') > -1) {
                    OSType.OSType = "Android";
                }

                return OSType;
            }
        };

        //运行加载方法
        vPage.init();
    </script>


</body>
</html>